<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Producto</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<section class="container mt-5">
    <div class="row">
        <div class="col-md-6">
            <img th:src="${producto.imagenUrl}" class="img-fluid" alt="Imagen del producto">
        </div>
        <div class="col-md-6">
            <h2 th:text="${producto.nombre}">Nombre del producto</h2>
            <p th:text="${producto.descripcion}">Descripción del producto</p>
            <h4 th:text="${producto.precio}">$0.00</h4>
            
            <!-- Formulario para agregar al carrito (se cambia a un botón que llama a JavaScript) -->
            <input type="hidden" id="productoId" th:value="${producto.id}">
            <input type="hidden" id="nombreProducto" th:value="${producto.nombre}">
            <input type="hidden" id="precioProducto" th:value="${producto.precio}">
            
            <!-- Selección de cantidad -->
            <div class="form-group">
                <label for="cantidad">Cantidad:</label>
                <input type="number" id="cantidad" value="1" min="1" class="form-control" required>
            </div>

            <!-- Botón para agregar al carrito -->
            <button onclick="addToCart()" class="btn btn-primary">Agregar al carrito</button>
        </div>
    </div>

    <!-- Lista de productos en el carrito -->
    <div class="mt-5">
        <h3>Productos en tu carrito:</h3>
        <ul id="cart-products-list">
            <!-- Se llenará dinámicamente con JavaScript -->
        </ul>
    </div>
</section>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    function addToCart() {
        const productoId = document.getElementById("productoId").value;
        const nombre = document.getElementById("nombreProducto").value;
        const precio = parseFloat(document.getElementById("precioProducto").value);
        const cantidad = parseInt(document.getElementById("cantidad").value);

        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        // Verificar si el producto ya está en el carrito
        const existingProductIndex = cart.findIndex(item => item.productoId === productoId);
        if (existingProductIndex !== -1) {
            // Si ya existe, actualizar la cantidad
            cart[existingProductIndex].cantidad += cantidad;
        } else {
            // Si no existe, agregar el nuevo producto
            cart.push({ productoId, nombre, precio, cantidad });
        }

        localStorage.setItem("cart", JSON.stringify(cart));
        alert("Producto agregado al carrito");
        updateCartDisplay();
    }

    function updateCartDisplay() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const cartProductsList = document.getElementById("cart-products-list");
        cartProductsList.innerHTML = "";

        cart.forEach(item => {
            const productItem = document.createElement("li");
            productItem.textContent = `${item.nombre} - ${item.cantidad} unidades - $${(item.precio * item.cantidad).toFixed(2)}`;
            cartProductsList.appendChild(productItem);
        });
    }

    // Cargar la vista del carrito al iniciar la página
    document.addEventListener("DOMContentLoaded", updateCartDisplay);
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>
